(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-fd7f"],{OHis:function(t,e,i){"use strict";var a=i("ZUlP");i.n(a).a},Yfch:function(t,e,i){"use strict";function a(t){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/.test(t)}i.d(e,"a",function(){return a})},ZUlP:function(t,e,i){},q4Ke:function(t,e,i){"use strict";i.r(e);var a=i("Q2AE"),o=i("Yfch"),r=i("wk8/"),s=i("t3Un");var n={props:{email:{type:String,required:!0}},data:function(){var t=this;return{loading:!1,dialog:!1,title:"修改邮箱",form:{pass:"",email:"",code:""},user:{email:"",password:""},codeLoading:!1,codeData:{type:"email",value:""},buttonName:"获取验证码",isDisabled:!1,time:60,rules:{pass:[{required:!0,validator:function(t,e,i){Object(r.g)(e).then(function(t){200===t.status?i():i(new Error("密码错误，请重新输入"))})},trigger:"blur"}],email:[{required:!0,validator:function(e,i,a){""===i?a(new Error("新邮箱不能为空")):i===t.email?a(new Error("新邮箱不能与旧邮箱相同")):Object(o.a)(i)?a():a(new Error("邮箱格式错误"))},trigger:"blur"}],code:[{required:!0,message:"验证码不能为空",trigger:"blur"}]}}},methods:{cancel:function(){this.resetForm()},sendCode:function(){var t=this;if(this.form.email&&this.form.email!==this.email){this.codeLoading=!0,this.buttonName="验证码发送中",this.codeData.value=this.form.email;var e=this;(function(t){return Object(s.a)({url:"api/code/resetEmail",method:"post",data:t})})(this.codeData).then(function(i){t.$message({showClose:!0,message:"发送成功，验证码有效期5分钟",type:"success"}),t.codeLoading=!1,t.isDisabled=!0,t.buttonName=t.time--+"秒后重新发送",t.timer=window.setInterval(function(){e.buttonName=e.time+"秒后重新发送",--e.time,e.time<0&&(e.buttonName="重新发送",e.time=60,e.isDisabled=!1,window.clearInterval(e.timer))},1e3)}).catch(function(e){t.resetForm(),t.codeLoading=!1,console.log(e.response.data.message)})}},doSubmit:function(){var t=this;this.$refs.form.validate(function(e){if(!e)return!1;t.loading=!0,t.user={email:t.form.email,password:t.form.pass},Object(r.d)(t.form.code,t.user).then(function(e){t.loading=!1,t.resetForm(),t.$notify({title:"邮箱修改成功",type:"success",duration:1500}),a.a.dispatch("GetInfo").then(function(){})}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),window.clearInterval(this.timer),this.time=60,this.buttonName="获取验证码",this.isDisabled=!1,this.form={pass:"",email:"",code:""}}}},l=(i("OHis"),i("KHd+")),u=Object(l.a)(n,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"inline-block"}},[i("el-dialog",{attrs:{visible:t.dialog,title:t.title,"append-to-body":"",width:"475px"},on:{"update:visible":function(e){t.dialog=e},close:t.cancel}},[i("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,size:"small","label-width":"88px"}},[i("el-form-item",{attrs:{label:"新邮箱",prop:"email"}},[i("el-input",{staticStyle:{width:"200px"},attrs:{"auto-complete":"on"},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}}),t._v(" "),i("el-button",{attrs:{loading:t.codeLoading,disabled:t.isDisabled,size:"small"},on:{click:t.sendCode}},[t._v(t._s(t.buttonName))])],1),t._v(" "),i("el-form-item",{attrs:{label:"验证码",prop:"code"}},[i("el-input",{staticStyle:{width:"320px"},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"当前密码",prop:"pass"}},[i("el-input",{staticStyle:{width:"320px"},attrs:{type:"password"},model:{value:t.form.pass,callback:function(e){t.$set(t.form,"pass",e)},expression:"form.pass"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"text"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.doSubmit}},[t._v("确认")])],1)],1)],1)},[],!1,null,"a0e94680",null);u.options.__file="updateEmail.vue";e.default=u.exports},"wk8/":function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"b",function(){return r}),i.d(e,"c",function(){return s}),i.d(e,"g",function(){return n}),i.d(e,"f",function(){return l}),i.d(e,"d",function(){return u}),i.d(e,"e",function(){return c});var a=i("t3Un");function o(t){return Object(a.a)({url:"api/users",method:"post",data:t})}function r(t){return Object(a.a)({url:"api/users/"+t,method:"delete"})}function s(t){return Object(a.a)({url:"api/users",method:"put",data:t})}function n(t){var e={password:t};return Object(a.a)({url:"api/users/validPass/",method:"post",data:e})}function l(t){var e={password:t};return Object(a.a)({url:"api/users/updatePass/",method:"post",data:e})}function u(t,e){return Object(a.a)({url:"api/users/updateEmail/"+t,method:"post",data:e})}function c(t){return Object(a.a)({url:"api/users/updateNickname/",method:"post",data:t})}}}]);