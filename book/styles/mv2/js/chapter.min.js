/*!
 * Powered by uglifiyJS v2.6.1, Build by http://jsmin.6tie.net
 * build time: Sun Mar 15 2020 13:40:11 GMT+0800 (China Standard Time)
*/
function toggleOpt(t,a){var e=this;if(!t)return e;$.isFunction(a)&&(a={callback:a});var i={mode:"visible",container:$("body"),callback:function(){}},n=$.extend({},i,a||{});e.callback=n.callback,e.mode=n.mode,!t.size&&$.isArray(t)&&(t=t.join()),"string"==typeof t?n.container.on("click",t,function(t){toggleOptToggle($(this),t)}):t.length&&t.on("click",function(t){toggleOptToggle($(this),t)}),toggleOptAria(t)}function toggleOptAria(t){"visible"==this.mode&&"string"==typeof t&&$(t).each(function(){var t=$(this);t.attr({role:"menuitem","aria-expanded":t.hasClass("active")})})}function toggleOptToggle(t,a){var e,i=this,n=t;"visible"==i.mode?(n=$("#"+t.attr("data-rel")),(e=t.hasClass("active"))?(t.removeClass("active").attr("aria-expanded","false"),n.removeClass("active")):(t.addClass("active").attr("aria-expanded","true"),n.addClass("active"))):"more"==i.mode&&((e="string"==typeof t.attr("open"))?t.removeAttr("open"):t.attr("open",""))}function rangeOpt(t,a){var e=this,i={container:$("body"),shadow:!1,buttons:["",""],onChangeEnd:function(){},tips:function(t){return t}},n=$.extend({},i,a||{}),s=t.attr("min")||0,o=t.attr("max")||100,r=t.attr("step")||1,l=$("<div></div>").attr("class",t.attr("class")).addClass("range"),c=$("<div></div>").addClass("range-track"),d=$("<a></a>").addClass("range-thumb").attr({role:"slider","aria-valuenow":t.val(),"aria-valuemax":o,"aria-valuemin":s}),h=$();1==n.shadow&&(h=$("<a></a>").addClass("range-shadow").attr("title","\u4e4b\u524d\u4f4d\u7f6e")),t.before(l),0==l.width()&&l.width(t.width()),c.append(d),l.append(c).prepend(h),l.on("click",function(a){var i=a&&a.target;if(i)if(h.length&&i==h[0]){var r=$(i).attr("data-value"),l=t.val();r&&l!=r&&(rangeOptValue(r),n.onChangeEnd.call(t,e))}else if(i!=d[0]){var c=a.clientX-(d.offset().left-$(window).scrollLeft())-d.width()/2;rangeOptValue(1*t.val()+(o-s)*c/$(this).width()),n.onChangeEnd.call(t,e)}});var p={distance:0};return d.on("touchstart",function(a){var e=a.touches[0]||a;p.x=e.pageX,p.value=1*t.val(),p.distance=0;var i=p.value;$.isFunction(n.tips)&&(i=n.tips.call(t,p.value)),d.attr("data-tips",i).attr("aria-valuenow",i).addClass("active")}),n.container.on({touchmove:function(a){var e=a.touches[0]||a;if("number"==typeof p.x){var i=e.pageX-p.x;p.distance=i,rangeOptValue(p.value+(o-s)*i/l.width());var r=t.val();$.isFunction(n.tips)&&(r=n.tips.call(t,r)),d.attr("data-tips",r).attr("aria-valuenow",r),a.preventDefault()}},touchend:function(){Math.abs(p.distance)>0&&n.onChangeEnd.call(t,e),p.x=null,p.value=null,d.removeClass("active"),p.distance=0}}),$.isArray(n.buttons)&&n.buttons.forEach(function(a,i){a&&("string"==typeof a&&(a=$(a)),a.length&&(a.on("click",function(){var a=+$(this).data("index"),i=t.attr("max"),s=t.attr("min")||"1",o=t.attr("step")||"1",r=t.val(),l=r;0==a?(l=r-o)<s&&(l=s):1==a&&(l=1*r+1*o)>i&&(l=i),l!==r&&(rangeOptValue(l),n.onChangeEnd.call(t,e))}).data("index",i),a.attr("role","button")))}),this.num={min:+s,max:+o,step:+r},this.el={input:t,container:l,track:c,thumb:d,shadow:h},this.callback={changeEnd:n.onChangeEnd.bind(t,e)},this.obj={},rangeOptValue(),rangeOptShadow(),this}function rangeOptValue(t){var a=this.el.input,e=a.val(),i=this.num.max,n=this.num.min,s=this.num.step;return t||(e=t,t=$.trim(a.val())),t=t>i||s/2>i-t?i:""==t||n>t||s/2>t-n?n:n+Math.round((t-n)/s)*s,a.val(t),rangeOptPosition(),t!=e&&a.trigger("change"),this}function rangeOptPosition(){var t=this.el.input.val(),a=this.num.max,e=this.num.min;return this.num.step,this.el.track.css("borderLeftWidth",this.el.container.width()*(t-e)/(a-e)),this}function rangeOptShadow(){var t=this.el,a=t.track,e=t.shadow;return e.length&&e.css("left",a.css("borderLeftWidth")).attr("data-value",t.input.val()),this}"undefined"==typeof BookChapterUtils&&(BookChapterUtils={}),BookChapterUtils={params:{settingsJson:{dn:"d",fs:3,skin:0},catalog_cache:!1,settingsKey:"SET_CHAPTER"},init:function(){this.initModes(),this.initOptionsLayer(),this.initFontSizeSetting(),this.initSkinSetting(),this.initModeSetting(),this.initDayNightSetting(),this.initChapterProgress(),this.initCatalogs()},initChapterProgress:function(){var t=$("#readOptProg");$("#readBtnProg").click(function(){var a=$(this);a.hasClass("active")?(a.removeClass("active"),t.removeClass("active")):(a.addClass("active"),t.addClass("active"))})},handlerClick:function(t,a,e){var i=($("#readContent"),$("#pageReadOpt")),n=$(window),s=n.height(),o=n.scrollTop(),r=[o+s/3,o+2*s/3];if(a<=r[0])try{var l=Math.max(0,scrollY-innerHeight);l>0&&(l+=44),window.scrollTo({top:l,behavior:"smooth"})}catch(a){}else if(a>=r[1])try{var l=innerHeight+scrollY,c=$("#readLoadNext").offset().top;c>l+50&&window.scrollTo({top:l-44,behavior:"smooth"})}catch(a){}else i[0].avoidClick=!0,setTimeout(function(){i[0].avoidClick=!1},500),i.addClass("active")},initModes:function(){var t=this,a={},e=!1,i=$("body"),n=$("#chapterContent"),s=t.params,o=$("#readBtnMode"),r=o.find("h4"),l=BookUtils.getStorage(t.params.settingsKey);if(l){var c=l.dn,d=l.fs,h=l.skin,n=$("#chapterContent"),p=$("#readFontRange");if(c&&"n"==c)o.data("mode","day"),r.html(r.html().replace("\u591c","\u65e5")),i.addClass("read-night"),$('#readSetSkin [type="radio"]').each(function(){var t=$(this);t.prop("checked")&&t.prop("checked",!1)});else if(h&&!isNaN(h)){s.settingsJson=$.extend(s.settingsJson,{skin:parseInt(h)});var g=$('[data-index="'+h+'"]',"#readSetSkin"),u=g.val();g.attr("checked","true"),i.attr("class",i.attr("class").replace(/skin-[a-z]+/g,"skin-"+u))}d&&!isNaN(d)&&(p.val(d),n.css("font-size",(2*d+12)/16+"rem"),s.settingsJson=$.extend(s.settingsJson,{fs:parseInt(d)}))}if($("#readContent").on({touchstart:function(t){var i=(t.target||{},t.touches[0]||t);a.x1=i.pageX,a.y1=i.pageY,e=!0},touchmove:function(t){e&&(e=!1)},touchend:function(i){e&&(e=!1,t.handlerClick(a.x1,a.y1,i))}}),!window.localStorage.getItem("help")){var v=$('<ul class="shadow" id="help"><li class="help-top">'+i18nUtils.prop("book_chapter_tip_pre_page")+'</li><li class="help-bottom">'+i18nUtils.prop("book_chapter_tip_next_page")+'</li><li class="help-left">&nbsp;</li><li class="help-right">&nbsp;</li><li class="help-center">'+i18nUtils.prop("book_chapter_tip_menu")+"</li></ul>");$("body").append(v),v.click(function(t){t.stopPropagation(),v.remove(),window.localStorage.setItem("help",1)})}},initOptionsLayer:function(){var t=$("#pageReadOpt"),a=$("#readBtnMore");t.on({click:function(a){var e=a.target;if(e===this&&!e.avoidClick){var i=t.find(".jsLayerTrigger.active");i.length&&i.trigger("click"),t.removeClass("active")}},touchstart:function(t){this.flagMoveHide=t.target===this},touchmove:function(a){this.flagMoveHide&&t.trigger("click"),a.preventDefault()}}),toggleOpt(a);var e=$(".jsLayerTrigger");e.on("click",function(t){var a=this;t&&(!1===t.isTrusted||t.hasOwnProperty("_args")||0===t.pageY&&0===t.screenY)||e.each(function(){var t=$(this);this!==a&&t.hasClass("active")&&t.trigger("click")})})},initFontSizeSetting:function(){var t=this,a=$("#readBtnSet"),e=$("#readFontRange"),i=$("#chapterContent");toggleOpt(a),rangeOpt($("#readFontRange"),{buttons:["#readFontDown","#readFontUp"]}),e.on("change",function(a){var e=this.value,n=(2*e+12)/16;i.css("font-size",n+"rem"),t.updateSettings({fs:e})})},initSkinSetting:function(){var t=this,a=$("body"),e=$("#readBtnMode");$("#readSetSkin").on("click",'[type="radio"]',function(){var i=$(this);a.removeClass("read-night"),a.attr("class",a.attr("class").replace(/skin-[a-z]+/g,"skin-"+i.val())),"day"===e.data("mode")&&e.trigger("click"),t.updateSettings({skin:i.data("index")})})},initModeSetting:function(){},initDayNightSetting:function(){var t=this,a=$("body"),e=$("#readBtnMode"),i=e.find("h4");e.on("click",function(){var n=e.data("mode");if("day"===n){e.data("mode","night"),i.html(i.html().replace("\u65e5","\u591c")),i.html(i.html().replace("Day","Night")),a.removeClass("read-night");var s=a.attr("class").match(/skin-([a-z]+)/);s&&(s=s[1],$('#readSetSkin [type="radio"][value="'+s+'"]').prop("checked",!0)),t.updateSettings({dn:"d"})}else"night"===n&&(e.data("mode","day"),i.html(i.html().replace("\u591c","\u65e5")),i.html(i.html().replace("Night","Day")),a.addClass("read-night"),$('#readSetSkin [type="radio"]').each(function(){var t=$(this);t.prop("checked")&&t.prop("checked",!1)})),t.updateSettings({dn:"n"}),e.attr("data-model","day")})},updateSettings:function(t){var a=this,e=a.params;e.settingsJson=$.extend(e.settingsJson,t),BookUtils.setStorage(e.settingsKey,e.settingsJson)},jumpChapter:function(t,a,e,i){},initCatalogs:function(){$("#asideOverlay").click(function(){$("#asideChapter").removeClass("active"),$("html").removeClass("noscroll")})},showCatalogCallback:function(t){if($("#asideChapter").addClass("active"),$("html").addClass("noscroll"),t){var a=$("#c"+t),e=$("#catelogX");a.find("span").addClass("red"),setTimeout(function(){var t=a.position().top,i=$(window).height();t>i&&e.scrollTop(t-i/2)},300)}layer.closeAll()},showCatalogs:function(t,a,e){var i=this;layer.open({type:2}),i.params.catalog_cache?i.showCatalogCallback(e):i.cachedScript(t,function(){i.cachedScript(a,function(){i.showCatalogCallback(e),i.params.catalog_cache=!0,$("#reverse").on("click",function(){var t=$(this),a=i18nUtils.prop("book_list_desc_order"),e=i18nUtils.prop("book_list_asc_order");t.html(a===t.html()?e:a);var i=a===t.html()?"asc":"desc";tinysort("#volumes>li",{selector:"span",data:"num",order:i})})},function(){layer.open({content:"load error2.",skin:"msg",time:2}),layer.closeAll()})},function(){layer.open({content:"load error1.",skin:"msg",time:2}),layer.closeAll()})},cachedScript:function(t,a,e){var i=document.createElement("script"),n=$(i);i.src=t,$("head").append(i),n.bind("load",a),n.bind("error",e)}};