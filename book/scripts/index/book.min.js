/*!
 * Powered by uglifiyJS v2.6.1, Build by http://jsmin.6tie.net
 * build time: Sun Mar 29 2020 18:49:09 GMT+0800 (China Standard Time)
*/
$.storage=function(o,e,t){var a=function(){try{return localStorage.setItem("storage",""),localStorage.removeItem("storage"),localStorage}catch(o){var e=document.cookie.split(";");return{length:function(){return e.length}(),key:function(o){var t=e[o].split("="),a=decodeURIComponent(t.shift());return a},getItem:function(o){return $.cookie(o)},setItem:function(o,e){$.cookie(o,e,{expires:t||31536e3})},removeItem:function(o){$.cookie(o,null)},clear:function(){$.cookie(null)}}}}(),i={},r=parseInt((new Date).getTime()/1e3);if(void 0===o){for(var n,s=0;s<a.length;s++)n=a.key(s),e=$.kv(n),e&&(i[n]=e);return i}if(null===o)a.clear();else{if(void 0===e)return(i=a.getItem(o))?(i=JSON.parse(i),i.expires&&r>i.expires?($.kv(o,null),!1):i=i.value):!1;null===e?a.removeItem(o):(i={time:r,expires:t?r+t:0,value:e},i=JSON.stringify(i),a.setItem(o,i))}},"undefined"==typeof BookUtils&&(BookUtils={}),BookUtils={tip:function(o){$.jBox.tip(o,"success")},loading:function(o){$.jBox.tip("loading...","loading")},close:function(o){$.jBox.closeTip()},testStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(o){return!1}},getStorage:function(o){try{return JSON.parse($.storage(o))}catch(e){return null}},setStorage:function(o,e){try{return $.storage(o,JSON.stringify(e))}catch(t){return null}},removeStorage:function(o){return $.storage(o,null)},clearStorage:function(){return $.storage(null)},render:function(o,e){var t=document.getElementById(o).innerHTML;return ejs.render(t,e,{delimiter:"$"})},params:{is_login:!1,key_bookshelf:"BOOK_SHELF",key_recently_read:"RECENTLY_READ",is_append:!0,catalog_cache:!1},getArrayDataFromStorage:function(o){var e=this.getStorage(o);return Array.isArray(e)?e:[]},addBookToStorage:function(o,e){var t=$("#artWrap");if(t.length>0){var a={bid:t.data("bid"),bUrl:t.data("burl"),bName:t.data("bname"),cid:t.data("cid"),cName:t.data("cname"),aName:t.data("aname")};e?this.addBook(o,a):(this.updateBook(o,a),this.params.is_login&&this.params.key_bookshelf===o&&$.post("/CsAjax.do?method=updateMyFav",{book_id:a.bid,chapter_id:a.cid,chapter_name:a.cName},function(o){}))}},addBookToStorageForBookShelf:function(){this.addBookToStorage(this.params.key_bookshelf,!0)},addBookToStorageForRecentRead:function(){this.addBookToStorage(this.params.key_recently_read,!0),this.addBookToStorage(this.params.key_bookshelf,!1)},getBooksFromStroage:function(o){var e=this,t=e.getArrayDataFromStorage(o),a=t.map(function(o){return o.datetime=-1===o.time?"2015-01-11":e.formatDate(o.time,"YYYY-MM-DD"),o.time=-1===o.time?"01.11":e.toNow(o.time),o});return a},updateBook:function(o,e){for(var t=e,a=this.getArrayDataFromStorage(o),i=0,r=a.length;r>i;i++)if(a[i].bid===t.bid){this.checkIsInBookshelf(!0),a.splice(i,1);var n=$.extend(e,{time:(new Date).getTime()});a.unshift(n),this.setStorage(o,a.slice(0,20));break}},addBook:function(o,e){for(var t=e,a=this.getArrayDataFromStorage(o),i=0,r=a.length;r>i;i++)if(a[i].bid===t.bid){a.splice(i,1);break}var n=$.extend(e,{time:(new Date).getTime()});a.unshift(n),this.setStorage(o,a.slice(0,20))},checkIsInBookshelf:function(o,e){var t=$("#btnAddToBookshelf");o?(e&&""!=e&&$("#btnReadBook").attr("href",e).find("em").html(i18nUtils.prop("book_bookshelf_continue_reading")),t.data("bookshelf-status",1).addClass("disabled"),t.find("em").length>0?t.find("em").html(i18nUtils.prop("book_bookshelf_exists")):t.find("i").length>0&&t.html(i18nUtils.prop("book_bookshelf_exists")+" <i></i>")):t.data("bookshelf-status",0)},initForBookView:function(){this.goShiTou(),this.addTingShu(),this.initDownload();var o=this;o.initCheckBookStatus(),o.showHistory(),setTimeout(function(){o.checkIsLogin(),o.updateBookTop(),o.updateBookViewCount()},2e3)},goShiTou:function(){if("undefined"!=typeof cur_location_url&&-1!==cur_location_url.indexOf("-mulu.html")){var o="/book/"+$("#customer_url").val()+".html",e='<div class="book_func clearfix" style="width: 100%;margin-top: 5px"> <ul> <li><a href='+o+' style="height: 40px;line-height: 40px;"> <em>'+i18nUtils.prop("book_read_cover")+'</em></a></li> <li><a id="btnAddToBookshelf" style="height: 40px;line-height: 40px;"> <em>'+i18nUtils.prop("book_read_bookshelf")+'</em></a></li> <li id="freeDownload"> <a href="javascript:;" class="btn_down_book cur" style="height: 40px;line-height: 40px;"> <em>'+i18nUtils.prop("book_read_download")+'</em> </a> </li> <li> <a target="_blank" class="curbuy" href="/dashang.html" style="height: 40px;line-height: 40px;"> <em>'+i18nUtils.prop("book_read_donate")+"</em> </a> </li> </ul> </div>";$("#artWrap").after(e)}},initDownload:function(){$(".book_dirnew,.book_dircont").each(function(){var o=$(this),e=o.height(),t=500;if(o.data("oriheight",e),e>t){o.height(t).css({overflow:"hidden"});var a="\u5c55\u5f00\u5168\u90e8";"undefined"!=typeof i18nUtils&&(a=i18nUtils.prop("book_expend")),o.after('<div class="book-more" style="color: #7a8f9a;font-size: 14px;z-index: 800; width: 100%; height: 30px; background: linear-gradient(-180deg,rgba(249, 249, 249,.8) 0,#fff 90%);padding-top: 25px;text-align: center;cursor: pointer;"><span style="padding: 6px 15px 6px 15px; border: solid 1px #44719a; border-radius: 20px;color: #44719a;">'+a+'<span class="book-more-arrowdown bounce" style="display: inline-block; margin-left: 8px; height: 14px; width: 14px; background: url(/images/arrow-down.png);"></span></span></div>'),$(".book-more").click(function(){o.height(o.data("oriheight")),$(this).hide()})}}),$("#freeDownload").click(function(){var o=$("#book_name").val(),e=$("#book_id").val(),t=$("#customer_url").val(),a="/files/book/qrcode/"+e+"/"+t+".png",i='<div class="pop_down" id="pop_down_apk">   <div class="pop_win">	    <div class="pop_content">	   	   <div class="down_tit"><h3><b>'+o+'</b></h3></div>		   <div class="down_box">				<ul class="clearfix">					<li>						<div class="down_item down_book_apk"><div id="ads_div"></div><p>&nbsp;</p>						</div>					</li>					<li>						<div class="down_item down_book_txt">							<p class="item_qr"><img src="'+a+'" width="120" height="120" /></p>							<p class="item_txt">'+i18nUtils.prop("book_read_scan_download_tip")+'</p>							<p class="item_btn"><a href="/download/'+t+'.html" target="_blank">'+i18nUtils.prop("book_read_go_download")+'<i class="icon_txt"></i></a></p>						</div>					</li>				 </ul>         </div>		   <div class="down_tip"><span><a href="/client/index.html" target="_blank">'+i18nUtils.prop("book_read_download_tip")+'</a></span></div>		   <div class="down_ios"></div>	   </div>	</div></div>';$.jBox(i,{top:"160px",title:o+i18nUtils.prop("book_read_download"),width:710,draggable:!1,buttons:{}}),"undefined"!=typeof site_enabled_g&&site_enabled_g&&($("#ads_div").load("/scripts/ads/ads_auto_no_write.js"),$(".down_ios").load("/scripts/ads/ads_auto_no_write.js"))})},addTingShu:function(){},checkIsLogin:function(o){var e=this;o?e.params.is_login=!0:$.post("/CsAjax.do?method=isLogin",{},function(o){"1"===o.ret&&(e.params.is_login=!0,$(".offline").hide(),$online=$(".online"),$online.find(".uname").attr("href","/bookshelfmy.html").text(o.user_name),$online.show())})},updateBookTop:function(){var o=$("#book_id").val();o&&$.post("/CsAjax.do?method=updateBookTop",{book_id:o,book_name:$("#book_name").val(),info_source:$("#info_source").val(),customer_url:$("#customer_url").val()},function(o){})},updateBookViewCount:function(){var that=this,book_id=$("#book_id").val();book_id&&$.post("/CsAjax.do?method=updateBookViewCount",{book_id:book_id},function(data){if(data.datas){var bookshelf=eval(data.datas),isLogin=bookshelf.is_login;if(bookshelf.is_in_bookshelf){var href="";if(-1!=bookshelf.chapter_id_read)var href="/read/"+$("#customer_url").val()+"/"+bookshelf.chapter_id_read+".html";that.checkIsInBookshelf(!0,href)}else if(!isLogin)for(var key=that.params.key_bookshelf,bid=$("#book_id").val(),m=that.getArrayDataFromStorage(key),i=0,n=m.length;n>i;i++)if(m[i].bid==bid){var href="";if(""!=m[i].cid&&""!=m[i].bUrl)var href="/read/"+m[i].bUrl+"/"+m[i].cid+".html";that.checkIsInBookshelf(!0,href);break}}})},initCheckBookStatus:function(){var o=this;$("#btnAddToBookshelf").on("click",function(){var e=$(this);return 1===e.data("bookshelf-status")?(o.tip(i18nUtils.prop("book_exist_in_bookshelf")),!1):(o.addBookToStorageForBookShelf(),void(o.params.is_login?$.ajax({type:"POST",url:"/CsAjax.do?method=addMyFav",data:{book_id:$("#book_id").val(),book_name:$("#book_name").val()},success:function(e){o.tip(e.msg),o.checkIsInBookshelf(!0)}}):(o.checkIsInBookshelf(!0),o.tip(i18nUtils.prop("book_bookshelf_add_success")))))})},formatDate:function(o,e){o instanceof Date||(o=new Date(o)),e=e||"YYYY-MM-DD HH:mm:ss";var t={"M+":o.getMonth()+1,"D+":o.getDate(),"H+":o.getHours(),"h+":o.getHours()%12==0?12:o.getHours()%12,"m+":o.getMinutes(),"s+":o.getSeconds(),"q+":Math.floor((o.getMonth()+3)/3),S:o.getMilliseconds()};/(Y+)/.test(e)&&(e=e.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length))),/(dd+)/.test(e)&&(e=e.replace(RegExp.$1,"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03".split("")[o.getDay()]));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e},toNow:function(o){var e=new Date(o).getTime();if(isNaN(e))return o;var t=(new Date).getTime()-e;return t>31536e6?i18nUtils.prop("book_bookshelf_year_before"):t>2592e6?Math.floor(t/2592e6)+i18nUtils.prop("book_bookshelf_month_before"):t>864e5?Math.floor(t/864e5)+i18nUtils.prop("book_bookshelf_day_before"):t>36e5?Math.floor(t/36e5)+i18nUtils.prop("book_bookshelf_hour_before"):t>6e4?Math.floor(t/6e4)+i18nUtils.prop("book_bookshelf_minute_before"):t>0?i18nUtils.prop("book_bookshelf_just_now"):this.formatDate(o)},sendError:function(o){layer&&layer.prompt({title:i18nUtils.prop("book_feedback_content"),formType:2},function(o,e){if(o&&o.length>200)return layer.msg(i18nUtils.prop("book_feedback_content_limit")),!1;layer.close(e);var t=window.location.href;$.post("/CsAjax.do?method=sendError",{url:t,error_msg:o},function(o){$("#sendError").hide(),"1"==o.code?layer.open({content:i18nUtils.prop("book_feedback_content_result"),btn:"Ok"}):layer.msg(o.msg)})})},initBookShelfHeader:function(o){var e=this;$(".btn-tab").on("click",function(){var o=$(this),t=o.data("type");$(".btn-tab").removeClass("cur"),o.addClass("cur"),e.loadHisotryOrBookShelf(t)}),""!=o&&($(".btn-tab").removeClass("cur"),$("#tab_"+o).addClass("cur"))},loadHisotryOrBookShelf:function(o){var e=this,t=this.params.key_bookshelf;if("recent"==o&&(t=this.params.key_recently_read),this.params.is_login&&t==this.params.key_bookshelf)e.loading(),$.post("/CsAjax.do?method=getBookshelfListCommon",{},function(o){if(e.close(),1==o.code){var t=o.datas,a=t.map(function(o){return o.datetime=-1===o.time?"2015-01-11":e.formatDate(o.time,"YYYY-MM-DD"),o.time=-1===o.time?"01.11":e.toNow(o.time),o}),i=e.render("tpl-bookshelf.html",{data:a});$("#bookEditOl").html(i)}});else{var a=this.getBooksFromStroage(t),i=this.render("tpl-history-read.html",{data:a});$("#bookEditOl").html(i),e.showHistory(a)}},showHistory:function(){var o=window.location.href;if(-1!==o.indexOf("/book/")){var e=this.getBooksFromStroage(this.params.key_recently_read);if(e.length>0){var t=$(".book_read_record"),a=$("#book_comment"),i=$("#recently-read"),r="",n="",s="";n+='<div class="book_hot_con mt20">',n+='<div class="v1_title"><span>'+i18nUtils.prop("book_recently_read")+"</span></div>",n+='<div class="book_hot_list">',n+='<ul class="clearfix">';var l="";"undefined"!=typeof ctx_cdn&&(l=ctx_cdn),e.map(function(o,e){var t="/book/"+o.bUrl+".html",a=l+"/files/book/cover/"+o.bid+"/cover.jpg";r+="<li><a href='"+t+"' target='_blank'>"+o.bName+"</a></li>",18>e&&(n+="<li>",s+='<li class="module-slide-li"><a href="/m'+t+'" class="module-slide-a"><img src="'+a+'" class="module-slide-img" onerror="this.src=\'/styles/index/images/noimage.jpg\'"/> <figcaption class="module-slide-caption">'+o.bName+'</figcaption> <p class="module-slide-author" role="option"></p> </a></li>',n+='<div><a href="'+t+'" target="_blank"><img src="'+a+'" style="width: 120px;height: 160px;" onerror="this.src=\'/styles/index/images/noimage.jpg\'" /></a></div>',n+='<div class="book_hot_info"> <span class="book_hot_name"><a href="'+t+'" target="_blank">'+o.bName+'</a></span> <span class="book_hot_author">'+i18nUtils.prop("book_author")+":"+o.aName+"</span> </div>",n+="</li>")}),t.show().find(".bgGray").empty().html(r),i.show().find("#ol").empty().html(s),n+="</ul>",n+="</div>",a.before(n)}}},removeMyfavHander:function(o){var e=this;$("#myfav_"+o).remove(),0==$("li","#bookEditOl").size()&&$("#bookEditOl").html('<div class="null">'+i18nUtils.prop("book_bookshelf_is_empty")+"</div>");for(var t=e.getArrayDataFromStorage(e.params.key_bookshelf),a=0,i=t.length;i>a;a++)if(t[a].bid==o){t.splice(a,1);break}e.setStorage(e.params.key_bookshelf,t)},removeMyfav:function(o){var e=this,t=function(t,a,i){return"ok"==t&&(e.params.is_login?$.post("/CsAjax.do?method=removeMyFavForM",{bids:o},function(t){1==t.code?($.jBox.tip(t.msg,"success"),e.removeMyfavHander(o)):$.jBox.tip(t.msg,"warning")}):e.removeMyfavHander(o)),!0};$.jBox.confirm(i18nUtils.prop("delete_tip"),"Tip",t)},getChapter:function(o){var e="/CsAjax.do?method=getChapter",t="text",a="POST";"undefined"!=typeof cdn_api&&""!==cdn_api&&(e=cdn_api+e,t="jsonp",a="GET"),$.ajax({type:a,data:"chapter_id="+$("#chapter_id").val(),dataType:t,url:e,success:function(o){"jsonp"===t?$("#artWrap").html(o.data):$("#artWrap").html(o),AudioUtils.initPlayBar("artWrap")},error:function(){var o="<p style='text-align:center;' onclick='BookUtils.getChapter()'>"+i18nUtils.prop("book_load_failed")+"</p>";$("#artWrap").html(o)}})},showCatalog:function(o,e,t){var a=this;layer.load(1),a.params.catalog_cache?a.showCatalogCallback(t):a.cachedScript(o).done(function(o,i){a.cachedScript(e).done(function(){a.showCatalogCallback(t),a.params.catalog_cache=!0})}).fail(function(o,e,t){layer.msg("load error."+t),layer.closeAll("loading")})},showCatalogCallback:function(o){var e=780,t=600;try{e=parseInt(.6*$(window).width()),t=parseInt(.8*$(window).height())}catch(a){}try{if(o){var i=$("#c"+o);i.find("a").css({color:"red"}),setTimeout(function(){var o=i.position().top,e=$(".layui-layer-content");o>t&&e.scrollTop(o-t/2)},300)}}catch(a){}layer.open({title:!1,type:1,anim:2,shadeClose:!0,area:[e+"px",t+"px"],content:$("#catalogs")}),layer.closeAll("loading")},cachedScript:function(o,e){return e=$.extend(e||{},{dataType:"script",cache:!0,url:o}),jQuery.ajax(e)}};