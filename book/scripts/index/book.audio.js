/*!
 * Powered by uglifiyJS v2.6.1, Build by http://jsmin.6tie.net
 * build time: Thu Mar 26 2020 17:48:30 GMT+0800 (China Standard Time)
*/
function rangeOptForAudio(t,a){var e=this,i={container:$("body"),shadow:!1,buttons:["",""],onChangeEnd:function(){},tips:function(t){return t}},n=$.extend({},i,a||{}),o=t.attr("min")||0,r=t.attr("max")||100,s=t.attr("step")||1,u=$("<div></div>").attr("class",t.attr("class")).addClass("range"),l=$("<div></div>").addClass("range-track"),d=$("<a></a>").addClass("range-thumb").attr({role:"slider","aria-valuenow":t.val(),"aria-valuemax":r,"aria-valuemin":o}),p=$();1==n.shadow&&(p=$("<a></a>").addClass("range-shadow").attr("title","\u4e4b\u524d\u4f4d\u7f6e")),t.before(u),0==u.width()&&u.width(t.width()),l.append(d),u.append(l).prepend(p),u.on("click",function(a){var i=a&&a.target;if(i)if(p.length&&i==p[0]){var s=$(i).attr("data-value"),u=t.val();s&&u!=s&&(rangeOptValueForAudio(s),n.onChangeEnd.call(t,e))}else if(i!=d[0]){var l=a.clientX-(d.offset().left-$(window).scrollLeft())-d.width()/2;rangeOptValueForAudio(1*t.val()+(r-o)*l/$(this).width()),n.onChangeEnd.call(t,e)}});var c={distance:0};return d.on("touchstart",function(a){var e=a.touches[0]||a;c.x=e.pageX,c.value=1*t.val(),c.distance=0;var i=c.value;$.isFunction(n.tips)&&(i=n.tips.call(t,c.value)),d.attr("data-tips",i).attr("aria-valuenow",i).addClass("active")}),n.container.on({touchmove:function(a){var e=a.touches[0]||a;if("number"==typeof c.x){var i=e.pageX-c.x;c.distance=i,rangeOptValueForAudio(c.value+(r-o)*i/u.width());var s=t.val();$.isFunction(n.tips)&&(s=n.tips.call(t,s)),d.attr("data-tips",s).attr("aria-valuenow",s),a.preventDefault()}},touchend:function(){Math.abs(c.distance)>0&&n.onChangeEnd.call(t,e),c.x=null,c.value=null,d.removeClass("active"),c.distance=0}}),$.isArray(n.buttons)&&n.buttons.forEach(function(a,i){a&&("string"==typeof a&&(a=$(a)),a.length&&(a.on("click",function(){var a=+$(this).data("index"),i=t.attr("max"),o=t.attr("min")||"1",r=t.attr("step")||"1",s=t.val(),u=s;0==a?(u=s-r)<o&&(u=o):1==a&&(u=1*s+1*r)>i&&(u=i),u!==s&&(rangeOptValueForAudio(u),n.onChangeEnd.call(t,e))}).data("index",i),a.attr("role","button")))}),this.num_audio={min:+o,max:+r,step:+s},this.el_audio={input:t,container:u,track:l,thumb:d,shadow:p},rangeOptValueForAudio(),this}function rangeOptValueForAudio(t){var a=this.el_audio.input,e=a.val(),i=this.num_audio.max,n=this.num_audio.min,o=this.num_audio.step;return t||(e=t,t=$.trim(a.val())),t=t>i||o/2>i-t?i:""==t||n>t||o/2>t-n?n:n+Math.round((t-n)/o)*o,a.val(t),rangeOptPositionForAudio(),t!=e&&a.trigger("change"),this}function rangeOptPositionForAudio(){var t=this.el_audio.input.val(),a=this.num_audio.max,e=this.num_audio.min;return this.num_audio.step,this.el_audio.track.css("borderLeftWidth",this.el_audio.container.width()*(t-e)/(a-e)),this}"undefined"==typeof AudioUtils&&(AudioUtils={}),AudioUtils={params:{maxChunkSize:100,minChunkSize:20,audioList:[],spd:6,per:0,preloadSize:2,audioSettings:{spd:6,per:0},audioSettingsKey:"SET_AUDIO"},mark:{$mark:null,$results:null,currentClass:"current",offsetTop:50,currentIndex:0},playSpeechElement:null,$content:null,url:"//tts.baidu.com/text2audio?cuid=baiduid&lan=zh&ctp=1&pdt=311&spd={spd}&per={per}&tex=",urlList:[],chunkList:[],audioList:[],curIndex:0,isFirstPlay:!0,isMobile:!1,init:function(){this.urlList=[],this.chunkList=[],this.audioList=[],this.curIndex=0,this.isFirstPlay=!0,this.playSpeechElement.data("status",0)},jumpToMark:function(){var t=this;if(t.mark.$results.length){var a,e=t.mark.$results.eq(t.mark.currentIndex);e.length&&(a=e.offset().top-t.mark.offsetTop,window.scrollTo(0,a))}},markText:function(t){var a=this;a.mark.$mark.unmark(),a.mark.$mark.mark(t,{separateWordSearch:!1,done:function(){a.mark.$results=a.$content.find("mark"),a.mark.currentIndex=0,a.jumpToMark()}})},play:function(){var t=this,a=t.chunkList[t.curIndex];try{var e=t.audioList[0].play();t.markText(a),this.playSpeechElement.data("status",1),this.playSpeechElement.next("label").text(i18nUtils.prop("book_audio_pause")),void 0!==e&&e["catch"](function(a){t.alert(i18nUtils.prop("book_audio_auto_play_error")),t.pause()})}catch(i){this.alert("Play error:"+i.message)}},pause:function(){var t=this;try{$.storage("auto-play","false")}catch(a){var e="set not auto play failed\uff1a"+a.message+"\n\n";t.alert(e,2)}try{this.audioList[0].pause(),this.playSpeechElement.data("status",-1),this.playSpeechElement.next("label").text(i18nUtils.prop("book_audio_play"))}catch(a){this.alert("Pause failed:"+a.message)}},seek:function(t){this.curIndex=Math.min(t,Math.max(this.urlList.length-1,0))},load:function(t){var a=Math.min(this.curIndex+t,this.urlList.length-1),e=this.urlList[a];(0==t&&this.isFirstPlay||1==t)&&(e=e.replace("{per}",this.params.per),e=e.replace("{spd}",this.params.spd),this.audioList[t].src=e)},loadAll:function(){var t=this;this.audioList.forEach(function(a,e){t.curIndex+e<t.urlList.length&&t.load(e)})},onAudioEnded:function(){var t=this;if(this.curIndex+1<this.urlList.length)this.audioList.push(this.audioList.shift()),this.curIndex+=1,this.playAudio(this.curIndex);else{t.mark.$mark.unmark();try{var a=$.storage("auto-play");"true"===a?t.goNextChapter():t.isMobile?layer.open({content:i18nUtils.prop("book_audio_play_end"),btn:[i18nUtils.prop("book_audio_play_auto"),i18nUtils.prop("book_audio_play_manual")],yes:function(a){$.storage("auto-play","true"),t.goNextChapter(),layer.close(a)},no:function(a){t.goNextChapter(),layer.close(a)}}):layer.confirm(i18nUtils.prop("book_audio_play_end"),{btn:[i18nUtils.prop("book_audio_play_auto"),i18nUtils.prop("book_audio_play_manual")]},function(){$.storage("auto-play","true"),t.goNextChapter()},function(){t.goNextChapter()})}catch(e){var i="not support cookie\uff1a"+e.message+"\n\n";t.alert(i,2)}}},goNextChapter:function(){var t=this,a=$("#nexturl").attr("href");"javascript:void(0);"!==a?(-1!==a.indexOf(";")&&(a=a.substring(0,a.indexOf(";"))),window.location.href=a):(t.pause(),this.alert(i18nUtils.prop("book_is_last_chapter"),2))},initPlayBar:function(t){var a=this;"bookDetailWrapper"===t&&(a.isMobile=!0),a.$content=$("#"+t);var e=BookUtils.getStorage(a.params.audioSettingsKey);e&&(a.params.spd=e.spd,a.params.per=e.per,$("#audioSpeedRange").val(e.spd),$("input[name='audioPer'][value='"+e.per+"']").prop("checked",!0)),a.mark.$mark=new Mark("#"+t),a.playSpeechElement=$("#play_audio"),a.playSpeechElement.click(function(){var t=a.playBarStatus();if(0===t){var e=a.$content.text();a.initAudio(e)}else 1===t?a.pause():a.play()}).next("label").text(i18nUtils.prop("book_audio_play"));try{var i=$("#audioOpt");if(a.isMobile)toggleOpt(i);else{var n=$.storage("auto-play");"true"===n&&$("#play_audio").click(),i.click(function(){layer.open({title:!1,type:1,anim:2,shadeClose:!0,area:["300px","179px"],content:$("#audioOptSet")})})}var o=$("#audioSpeedRange");rangeOptForAudio(o,{buttons:["#audioSpeedDown","#audioSpeedUp"]}),$("#audioSetLayout").on("click",'[type="radio"][name="audioPer"]',function(){var t=$(this);a.params.per=t.val(),a.updateAudioSettings({per:t.val()})}),o.on("change",function(t){var e=this.value;a.params.spd=e,a.updateAudioSettings({spd:e})})}catch(r){var s="Auto play error\uff1a"+r.message+"\n\n";a.alert(s,2)}},updateAudioSettings:function(t){var a=this,e=a.params;e.audioSettings=$.extend(e.audioSettings,t),BookUtils.setStorage(e.audioSettingsKey,e.audioSettings)},playAudio:function(t){this.seek(t),this.loadAll(),this.play()},restartAudio:function(){this.audioList[0].pause(),this.loadAll(),this.play()},alert:function(t,a){var e=this;a||(a=1),layer?e.isMobile?1===a?layer.open({content:t,skin:"msg",time:2}):layer.open({content:t,btn:"Ok"}):1===a?layer.msg(t):layer.open({content:t,btn:"Ok"}):alert(t)},initAudioList:function(){var t=this;try{for(var a=0;a<t.params.preloadSize;a++){var e=new Audio;e.addEventListener("play",function(){}),e.addEventListener("pause",function(){}),e.addEventListener("ended",function(){t.onAudioEnded()}),t.audioList.push(e)}}catch(i){var n=i18nUtils.prop("book_audio_play_not_support")+i.message+"\n\n";n+=i18nUtils.prop("book_audio_play_not_support_tip"),t.alert(n,2)}},playBarStatus:function(){var t=this.playSpeechElement.data("status");return t},initAudio:function(t){return!t||t.length<=0?(this.alert(i18nUtils.prop("book_audio_play_no_data")),!1):(this.init(),this.initAudioList(),this.initUrlList(t),this.playAudio(this.curIndex),void(this.isFirstPlay=!1))},text2Audio:function(t){var a=this;if(t&&t.length<=0)return a.alert(i18nUtils.prop("book_audio_play_no_data")),!1;var e=a.initUrlList(t),i=new Audio,n=1,o="https://tts.baidu.com/text2audio?cuid=baiduid&lan=zh&ctp=1&pdt=311&spd=6&tex=";return i.src=o+encodeURIComponent(e[0]),i.play(),i.onended=function(){n<e.length&&(i.src=o+encodeURIComponent(e[n]),i.play(),n++)},i},extraText:function(t){var a=this;if(t.length<=a.params.maxChunkSize)return t;for(var e=[];t.length>a.params.maxChunkSize;)e.push(t.slice(0,a.params.maxChunkSize)),t=t.slice(a.params.maxChunkSize);return e.push(t),e},initUrlList:function(t){var a=this,e=t.replace(/<\/?([^>]*)>/g,"$1"),e=e.trim().replace(/\s+/g," "),i=e.split(/[\u3002\uff1b\uff1f\uff01\uff1a:.;?!]/);return i=i.filter(function(t){return!/^\s*$/.test(t)}),a.chunkList=i,a.chunkList.map(function(t){a.urlList.push(a.url+encodeURIComponent(t))}),i},btts:function(t,a){function e(t){return"[object Function]"===Object.prototype.toString.call(t)?!0:!1}var i="//tsn.baidu.com/text2audio",n={volume:1,autoDestory:!0,autoplay:!0,timeout:1e4,hidden:!0},o=$.extend(n,a),r={spd:5,pit:5,vol:15,per:0},s=$.extend(r,t),u=document.createElement("audio");o.autoplay&&u.setAttribute("autoplay","autoplay"),o.hidden?u.style.display="none":u.setAttribute("controls","controls"),"undefined"!=typeof o.volume&&(u.volume=o.volume),e(o.onInit)&&o.onInit(u);var l=6e4,d=o.timeout||l,p=new XMLHttpRequest;p.open("POST",i);var c={};for(var s in t)c[s]=t[s];c.cuid=c.cuid||c.tok,c.ctp=1,c.lan=c.lan||"zh";var h=[];for(var m in c)h.push(m+"="+encodeURIComponent(c[m]));var v=new FileReader;p.responseType="blob",p.send(h.join("&"));var f=setTimeout(function(){p.abort(),e(o.onTimeout)&&o.onTimeout()},d);p.onreadystatechange=function(){4==p.readyState&&(clearTimeout(f),200==p.status&&("audio/mp3"===p.response.type&&(document.body.append(u),u.setAttribute("src",URL.createObjectURL(p.response)),u.onended=function(){e(o.onEnded)&&o.onEnded(),o.autoDestory&&document.body.removeChild(u)},e(o.onSuccess)&&o.onSuccess(u)),"application/json"===p.response.type&&(v.onload=function(){var t=v.result;e(o.onError)&&o.onError(t)},v.readAsText(p.response))))}}};