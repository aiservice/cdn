/*!
 * Powered by uglifiyJS v2.6.1, Build by http://jsmin.6tie.net
 * build time: Sun Mar 29 2020 18:52:34 GMT+0800 (China Standard Time)
*/
function goUrl(t){t&&(location.href=t)}"undefined"==typeof BookUtils&&(BookUtils={}),BookUtils={init:function(){this.initHeader(),this.initFooter()},initHeader:function(){var t,e=this,o=$(".jsBack").on("click",function(t){/^javas/.test(this.href)&&(t.preventDefault(),history.go(-1))});$("#openSearchPopup").on("click",function(o){o.preventDefault();var i=$(this).data("keyword")||"";$("#searchPopup").removeAttr("hidden"),$("#keyword").attr("placeholder",i).focus(),t||(t=!0,e.initSearch())});$("#guideOverlay").on("click",function(){$("#openGuide").trigger("click")}).attr("role","button");$("#openGuide").toggle(function(){$("#header").attr("open",""),$("#guide").addClass("active"),$(this).addClass("active").attr("aria-expanded","true")},function(){$("#header").removeAttr("open"),$("#guide").removeClass("active"),$(this).removeClass("active").attr("aria-expanded","false")});var i=$("#guide").on("touchmove",function(t){t.preventDefault()});i.length&&(window.addEventListener("resize",function(){e.elBacktop&&i.hasClass("active")&&e.elBacktop.trigger("click")}),$("#header").on("touchmove",function(t){i.hasClass("active")&&t.preventDefault()}));var a=document.referrer;"string"==typeof a&&""===a&&o.attr("href","/")},initFooter:function(){var t=$(window),e=$(".jsBackToTop").on("click",function(e){e.preventDefault();var o=t.scrollTop(),i=function(){(o*=.5)<1?t.scrollTop(0):(t.scrollTop(o),requestAnimationFrame(i))};i()});this.elBacktop=e;var o=$("#footerApp");t.on("scroll",function(){var i=t.scrollTop(),a=t.height();i>a&&(!o.length||i+a-o.position().top<=0)?e.css({opacity:1,visibility:"visible"}):e.css({opacity:0,visibility:"hidden"})})},initSearch:function(){$("#closeSearchPopup").on("click",function(){$("#searchPopup").attr("hidden",""),$("body").removeClass("open")}),this.initSearchForm(),this.initSearchPopularWords(),this.initSearchHistory()},initSearchForm:function(){var t=$("#keyword"),e=$("#clearSearchKeyword"),o=$("#searchHotHistory"),i=$("#searchList"),a=t.val().trim(),r=this;t.on("input",function(){(a=$(this).val().trim())?e.removeAttr("hidden"):(e.attr("hidden",""),o.removeAttr("hidden"),i.attr("hidden",""))}),e.on("click",function(){t.val("").trigger("input").focus()}),a&&(e.removeAttr("hidden"),o.attr("hidden","")),$("#searchForm").on("submit",function(){return""==t.val().trim()?(r.tip(i18nUtils.prop("book_search_keyword")),!1):void r.addSearchKeyword(a)})},setCookie:function(t,e,o){var i=new Date;i.setTime(i.getTime()+1e3*o),document.cookie=t+"="+escape(e)+";expires="+i.toUTCString()+";path=/"},tip:function(t){layer.open({content:t,skin:"msg",time:2})},loading:function(t){var e={type:2};t&&(e={type:2,content:t}),layer.open(e)},close:function(t){layer.closeAll()},initSearchPopularWords:function(){},initSearchHistory:function(){var t=this.getSearchKeywords(),e=this,o=this.render("tpl-search-history.html",{data:t}),i=$("#searchHistory").html(o);$("#clearSearchHistory").on("click",function(){e.clearSearchKeywords(),i.attr("hidden","")})},getSearchKeywords:function(){var t=this.getStorage("SEARCH_HISTORY");return Array.isArray(t)?t:[]},clearSearchKeywords:function(){this.removeStorage("SEARCH_HISTORY")},addSearchKeyword:function(t){if(""!=t){var e=this.getSearchKeywords(),o=e.indexOf(t);o>-1&&e.splice(o,1),e.unshift(t),this.setStorage("SEARCH_HISTORY",e)}},testStorage:function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(t){return!1}},getStorage:function(t){try{return JSON.parse($.storage(t))}catch(e){return null}},setStorage:function(t,e){try{return $.storage(t,JSON.stringify(e))}catch(o){return null}},removeStorage:function(t){return $.storage(t,null)},clearStorage:function(){return $.storage(null)},render:function(t,e){var o=document.getElementById(t).innerHTML;return ejs.render(o,e,{delimiter:"$"})},checkIsLogin:function(t){var e=this;t?(e.params.is_login=!0,$("#div_not_login").hide(),$("#div_logout").show().click(function(){layer.open({content:i18nUtils.prop("login_out_tip"),btn:[i18nUtils.prop("book_btn_ok"),i18nUtils.prop("book_btn_cancel")],yes:function(t){goUrl("/m/mlogin.html?method=logout")}})})):$.post("/CsAjax.do?method=isLogin",{},function(t){"1"==t.ret?(e.params.is_login=!0,$("#div_not_login").hide(),$("#div_logout").show().click(function(){layer.open({content:i18nUtils.prop("login_out_tip"),btn:[i18nUtils.prop("book_btn_ok"),i18nUtils.prop("book_btn_cancel")],yes:function(t){goUrl("/m/mlogin.html?method=logout")}})})):(e.params.is_login=!1,$("#p_login").text(i18nUtils.prop("book_btn_login")).click(function(){goUrl("/m/mlogin.html")}))})},comingSoon:function(){this.tip("coming soon...")},addTingShu:function(){},params:{pageNum:1,list_order_type:1,list_clsid:1e3,list_parid:1001,list_authorid:"",bids:[],is_login:!1,key_bookshelf:"BOOK_SHELF",key_recently_read:"RECENTLY_READ",bookshelf_type:"",is_append:!0},listTotalNum:0,editButtonHandler:function(){var t=this,e=$("#bookEditOl");$("#bookEditBtn").on("click",function(){t.params.bids=[],$("#header").attr("hidden",""),$("#editHeader").removeAttr("hidden"),$("#editBtnHeader").attr("hidden",""),e.hasClass("enabled")?(e.removeClass("enabled"),$("#bookEditOl .book-li.checked").removeClass("checked"),e.find('a[role="checkbox"]').attr("aria-checked","false")):e.addClass("enabled")}),e.on("click","li",function(){var o=this;if(e.hasClass("enabled")){var i=$(o).data("book-id");$(o).toggleClass("checked");var a=e.find("li.checked").length;$(o).find('a[role="checkbox"]').attr("aria-checked",$(o).hasClass("checked")),0==a?($(".selected-count").html(""),$("#bookEditPopup").removeClass("active"),t.params.bids=[]):($(o).hasClass("checked")?t.params.bids.push(i):t.params.bids.splice(t.params.bids.indexOf(i),1),$(".selected-count").html("("+a+")"),$("#bookEditPopup").hasClass("active")||$("#bookEditPopup").addClass("active"))}}),e.on("click","a",function(t){e.hasClass("enabled")&&t.preventDefault()})},initMultiSelect:function(){var t=$("#editBtnHeader"),e=$("#bookEditOl"),o=$("#header"),i=$("#editHeader"),t=$("#editBtnHeader");$(window).trigger("scroll"),$("#btnEditCancel").on("click",function(){e.removeClass("enabled"),o.removeAttr("hidden"),i.attr("hidden",""),t.removeAttr("hidden"),e.find("li.checked").removeClass("checked"),e.find('a[role="checkbox"]').attr("aria-checked","false"),$("#bookEditPopup").removeClass("active")}),$("#btnEditAll").on("click",function(){e.find("li").not(".checked").trigger("click")})},bookDeleteHandlerCallback:function(){var t=this,e=$("#bookEditOl"),o=$("#bookEditBtn"),i=$("#header"),a=$("#editHeader"),r=$("#editBtnHeader");$("#bookEditOl li.checked").remove(),e.removeClass("enabled"),o.html(i18nUtils.prop("book_btn_edit")),t.listTotalNum=t.listTotalNum-t.params.bids.length,t.listTotalNum<=0&&($("#bookEditOl").html('<div class="null">'+i18nUtils.prop("book_bookshelf_is_empty")+"</div>"),$("#book-li-more").remove()),$(".group-cnt").text(t.listTotalNum),a.find("h3").text(i18nUtils.prop("book_bookshelf_total")+t.listTotalNum+i18nUtils.prop("book_bookshelf_total_suf")),i.removeAttr("hidden"),a.attr("hidden",""),r.removeAttr("hidden"),$("#bookEditPopup").removeClass("active"),t.params.bids=[],e.addClass("enabled")},bookDeleteHandler:function(){var t=this;$("#bookDelBtn").on("click",function(){layer.open({content:i18nUtils.prop("delete_tip"),btn:[i18nUtils.prop("book_btn_delete"),i18nUtils.prop("book_btn_cancel")],yes:function(e){var o=t.params.bids,i=$.extend({},t.params);i.bids=o.toString(),t.params.is_login?$.post("/CsAjax.do?method=removeMyFavForM",{bids:i.bids},function(e){t.tip(e.msg),1==e.code&&t.bookDeleteHandlerCallback()}):t.bookDeleteHandlerCallback();for(var a=t.getArrayDataFromStorage(t.params.key_bookshelf),r=0,n=a.length;n>r;r++)if(-1!=i.bids.indexOf(a[r].bid)){a.splice(r,1);break}t.setStorage(t.params.key_bookshelf,a),layer.close(e)}})})},initForBookView:function(){this.addTingShu(),this.initSummary();var t=this;t.initCheckBookStatus(),t.showHistory(),setTimeout(function(){t.checkIsLogin(),t.updateBookTop(),t.updateBookViewCount()},2e3)},initBookShelf:function(t){this.editButtonHandler(),this.initMultiSelect(),this.bookDeleteHandler(),this.initBookShelfHeader(t),this.loadHisotryOrBookShelf(t),this.initSortForBookshelf()},initBookShelfHeader:function(t){var e=this;$(".btn-tab").on("click",function(){var t=$(this),o=t.data("type");$(".btn-tab").removeClass("active"),t.addClass("active"),e.loadHisotryOrBookShelf(o)}),""!=t&&($(".btn-tab").removeClass("active"),$("#tab_"+t).addClass("active"))},showHistory:function(){var t=this.getBooksFromStroage(this.params.key_recently_read);if(t.length>0){var e=$("#recently-read"),o="",i="";"undefined"!=typeof ctx_cdn&&(i=ctx_cdn),t.map(function(t){var e="/book/"+t.bUrl+".html",a=i+"/files/book/cover/"+t.bid+"/cover_120.jpg";o+='<li class="module-slide-li"><a href="/m'+e+'" class="module-slide-a"><img src="'+a+'" onerror="this.src=\'/styles/index/images/noimage.jpg\'" class="module-slide-img"/> <figcaption class="module-slide-caption">'+t.bName+'</figcaption> <p class="module-slide-author" role="option"></p> </a></li>'}),e.show().find("ol").empty().html(o)}},loadHisotryOrBookShelf:function(t){var e=this,o=this.params.key_bookshelf;if("recent"==t?(o=this.params.key_recently_read,$("#editBtnHeader").hide()):$("#editBtnHeader").show(),this.params.bookshelf_type=t,this.params.is_login&&o==this.params.key_bookshelf)e.loading(),$.post("/CsAjax.do?method=getBookshelfListCommon",{},function(t){if(e.close(),1==t.code){var o=t.datas,i=o.map(function(t){return t.datetime=-1===t.time?"2015-01-11":e.formatDate(t.time,"YYYY-MM-DD"),t.time=-1===t.time?"01.11":e.toNow(t.time),t}),a=e.render("tpl-bookshelf.html",{data:i});$("#bookEditOl").html(a),e.listTotalNum=o.length,$(".group-cnt").text(e.listTotalNum),$("#editHeader").find("h3").text(i18nUtils.prop("book_bookshelf_total")+e.listTotalNum+i18nUtils.prop("book_bookshelf_total_suf"))}});else{var i=this.getBooksFromStroage(o),a=this.render("tpl-history-read.html",{data:i});$("#bookEditOl").html(a),this.listTotalNum=i.length,$(".group-cnt").text(this.listTotalNum),$("#editHeader").find("h3").text(i18nUtils.prop("book_bookshelf_total")+e.listTotalNum+i18nUtils.prop("book_bookshelf_total_suf"))}},getArrayDataFromStorage:function(t){var e=this.getStorage(t);return Array.isArray(e)?e:[]},addBookToStorage:function(t,e){var o=$("#bookDetailWrapper"),i={bid:o.data("bid"),bUrl:o.data("burl"),bName:o.data("bname"),cid:o.data("cid"),cName:o.data("cname"),aName:o.data("aname")};e?this.addBook(t,i):(this.updateBook(t,i),this.params.is_login&&this.params.key_bookshelf==t&&$.post("/CsAjax.do?method=updateMyFav",{book_id:i.bid,chapter_id:i.cid,chapter_name:i.cName},function(t){}))},addBookToStorageForBookShelf:function(){this.addBookToStorage(this.params.key_bookshelf,!0)},addBookToStorageForRecentRead:function(){this.addBookToStorage(this.params.key_recently_read,!0),this.addBookToStorage(this.params.key_bookshelf,!1)},getBooksFromStroage:function(t){var e=this,o=e.getArrayDataFromStorage(t),i=o.map(function(t){return t.datetime=-1===t.time?"2015-01-11":e.formatDate(t.time,"YYYY-MM-DD"),t.time=-1===t.time?"01.11":e.toNow(t.time),t});return i},updateBook:function(t,e){for(var o=e,i=this.getArrayDataFromStorage(t),a=0,r=i.length;r>a;a++)if(i[a].bid==o.bid){this.checkIsInBookshelf(!0),i.splice(a,1);var n=$.extend(e,{time:(new Date).getTime()});i.unshift(n),this.setStorage(t,i.slice(0,20));break}},addBook:function(t,e){for(var o=e,i=this.getArrayDataFromStorage(t),a=0,r=i.length;r>a;a++)if(i[a].bid==o.bid){i.splice(a,1);break}var n=$.extend(e,{time:(new Date).getTime()});i.unshift(n),this.setStorage(t,i.slice(0,20))},initSummary:function(){var t=$("#bookSummary"),e=t[0],o=t.find("content"),i=t.find("textarea").val(),a=o.html();e&&e.scrollHeight>e.clientHeight&&(t.addClass("enabled"),t.on("click",function(){this.style&&this.style.height?(o.html(a),t.removeAttr("open"),this.style.height=""):(o.html(i),t.height("auto").attr("open",""))}))},updateBookTop:function(){var t=$("#book_id").val();t&&$.post("/CsAjax.do?method=updateBookTop",{book_id:t,book_name:$("#book_name").val(),info_source:$("#info_source").val(),customer_url:$("#customer_url").val()},function(t){})},updateBookViewCount:function(){var that=this,book_id=$("#book_id").val();book_id&&$.post("/CsAjax.do?method=updateBookViewCount",{book_id:book_id},function(data){if(data.datas){var bookshelf=eval(data.datas),isLogin=bookshelf.is_login;if(bookshelf.is_in_bookshelf){var href="";-1!=bookshelf.chapter_id_read&&(href="/m/read/"+$("#customer_url").val()+"/"+bookshelf.chapter_id_read+".html"),that.checkIsInBookshelf(!0,href)}else if(!isLogin)for(var key=that.params.key_bookshelf,bid=$("#book_id").val(),m=that.getArrayDataFromStorage(key),i=0,n=m.length;n>i;i++)if(m[i].bid==bid){var href="";""!=m[i].cid&&""!=m[i].bUrl&&(href="/m/read/"+m[i].bUrl+"/"+m[i].cid+".html"),that.checkIsInBookshelf(!0,href);break}}})},checkIsInBookshelf:function(t,e){t?(e&&""!=e&&$("#btnReadBook").attr("href",e).html(i18nUtils.prop("book_bookshelf_continue_reading")),$("#btnAddToBookshelf").data("bookshelf-status",1).html(i18nUtils.prop("book_bookshelf_exists")).removeAttr("href")):$("#btnAddToBookshelf").data("bookshelf-status",0)},initCheckBookStatus:function(){var t=this;$("#btnAddToBookshelf").on("click",function(){var e=$(this);return 1==e.data("bookshelf-status")?(t.tip(i18nUtils.prop("book_exist_in_bookshelf")),!1):(t.addBookToStorageForBookShelf(),void(t.params.is_login?$.ajax({type:"POST",url:"/CsAjax.do?method=addMyFav",data:{book_id:$("#book_id").val(),book_name:$("#book_name").val()},success:function(e){t.tip(e.msg),t.checkIsInBookshelf(!0)}}):(t.tip(i18nUtils.prop("book_bookshelf_add_success")),t.checkIsInBookshelf(!0))))})},formatDate:function(t,e){t instanceof Date||(t=new Date(t)),e=e||"YYYY-MM-DD HH:mm:ss";var o={"M+":t.getMonth()+1,"D+":t.getDate(),"H+":t.getHours(),"h+":t.getHours()%12==0?12:t.getHours()%12,"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(Y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),/(dd+)/.test(e)&&(e=e.replace(RegExp.$1,"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03".split("")[t.getDay()]));for(var i in o)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?o[i]:("00"+o[i]).substr((""+o[i]).length)));return e},toNow:function(t){var e=new Date(t).getTime();if(isNaN(e))return t;var o=(new Date).getTime()-e;return o>31536e6?i18nUtils.prop("book_bookshelf_year_before"):o>2592e6?Math.floor(o/2592e6)+i18nUtils.prop("book_bookshelf_month_before"):o>864e5?Math.floor(o/864e5)+i18nUtils.prop("book_bookshelf_day_before"):o>36e5?Math.floor(o/36e5)+i18nUtils.prop("book_bookshelf_hour_before"):o>6e4?Math.floor(o/6e4)+i18nUtils.prop("book_bookshelf_minute_before"):o>0?i18nUtils.prop("book_bookshelf_just_now"):this.formatDate(t)},initListBooks:function(){var t=$("#orders"),e=this;e.params.list_order_type=1,e.params.list_clsid=t.data("clsid"),e.params.list_parid=t.data("parid"),e.params.list_parid=t.data("parid"),e.params.list_authorid=t.data("authorid"),t.find("a").on("click",function(){var o=$(this),i=o.data("value");e.params.list_order_type!=i&&(e.params.list_order_type=i,t.find("a").removeClass("active"),o.addClass("active"),t.data("pagenum",0),e.loadListBooks())}),$("#loadMore").on("click",function(){e.loadListBooks()}),e.loadListBooks()},loadListBooks:function(t){var e=this,o=$("#books"),i=$("#orders"),a=$("#loadMore"),r=$("#loadFinished"),n=$("#search-kw"),s={type:i.data("type"),page_num:i.data("pagenum"),cls_id:e.params.list_clsid,par_id:e.params.list_parid,author_id:e.params.list_authorid,order_type:e.params.list_order_type,keyword:n.val()};e.loading(),r.hide(),$.post("/CsAjax.do?method=getBookListCommon",s,function(t){if(e.close(),1==t.code){var n=e.render("tpl-init-list.html",{data:t});0==s.page_num&&o.empty(),o.append(n);var l=s.page_num+1;i.data("pagenum",l),t.pageNum>1&&a.show(),l>=t.pageNum&&(a.hide(),r.show())}else e.tip(t.msg)})},initSortForMulu:function(){$("#reverse").on("click",function(){var t=$(this),e=i18nUtils.prop("book_list_desc_order"),o=i18nUtils.prop("book_list_asc_order");t.html(e===t.html()?o:e);var i=e===t.html()?"asc":"desc";tinysort("#volumes>li",{selector:"span",data:"num",order:i})});var t=window.location.toString(),e=t.split("#")[1];if(e){var o=$("#"+e).offset().top;$(window).scrollTop(o)}else this.foldChapters();this.initCheckBookStatus(),this.addTingShu();var i=this;setTimeout(function(){i.checkIsLogin(),i.updateBookTop(),i.updateBookViewCount()},2e3)},foldChapters:function(){var t=$(".chapter-ol-catalog"),e=t.height(),o=500;if(t.data("oriheight",e),e>o){t.height(o).css({overflow:"hidden"});var i="\u5c55\u5f00\u5168\u90e8";"undefined"!=typeof i18nUtils&&(i=i18nUtils.prop("book_expend"));var a=t.attr("id");if("audios"==a&&(i+=" (\u5171"+t.find("li").size()+"\u7ae0)"),t.after('<div class="book-more" style="color: #ed424b;font-size: 14px;z-index: 800; width: 100%; height: 30px; background: linear-gradient(-180deg,rgba(249, 249, 249,.8) 0,#fff 90%);padding-top: 25px;padding-bottom: 15px;text-align: center;cursor: pointer;"><span style="padding: 6px 15px 6px 15px; border: solid 1px #ed424b; border-radius: 20px;color: #ed424b;">'+i+"</span></div>"),"audios"==a){var r=t.find("li").last();"undefined"!=typeof r&&$(".book-more").after('<ol id="last_chapter" class="chapter-ol chapter-ol-catalog">'+r.html()+"</ol>"),$("#last_chapter").click(function(){t.height(t.data("oriheight")),$(".book-more").hide(),$("#last_chapter").remove()})}$(".book-more").click(function(){t.height(t.data("oriheight")),$(this).hide(),$("#last_chapter").remove()})}},initSortForBookshelf:function(){$("#timeOrder").on("click",function(){var t=$(this).find("li"),e="desc"===t.data("order")?"asc":"desc";tinysort("#bookEditOl>li",{selector:"i",data:"num",order:e}),t.data("order",e),$("#book-li-more").remove()})},getChapter:function(){var t="/CsAjax.do?method=getChapter",e="text",o="POST";"undefined"!=typeof cdn_api&&""!==cdn_api&&(t=cdn_api+t,e="jsonp",o="GET"),$.ajax({type:o,data:"chapter_id="+$("#chapter_id").val(),url:t,dataType:e,success:function(t){"jsonp"===e?$("#bookDetailWrapper").html(t.data):$("#bookDetailWrapper").html(t),AudioUtils.initPlayBar("bookDetailWrapper")},error:function(){var t="<p style='text-align:center;' onclick='BookUtils.getChapter()'>"+i18nUtils.prop("book_load_failed")+"</p>";$("#bookDetailWrapper").html(t)}})},sendError:function(){var t='<textarea style="border: 1px solid #ccc;width: 100%; height: 100px;line-height: 20px;" id="error_msg" class="layui-layer-input" placeholder="'+i18nUtils.prop("book_feedback_content")+'"></textarea>';layer.open({content:t,btn:[i18nUtils.prop("book_btn_cancel"),i18nUtils.prop("book_feedback_btn_submit")],skin:"footer",no:function(t){var e=$("#error_msg").val();if(!e)return layer.open({content:i18nUtils.prop("book_feedback_content"),skin:"msg",time:2}),!1;if(e=e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),""==e)return layer.open({content:i18nUtils.prop("book_feedback_content"),skin:"msg",time:2}),layer.msg(),!1;if(e.length>200)return layer.open({content:i18nUtils.prop("book_feedback_content_limit"),skin:"msg",time:2}),!1;layer.close(t);var o=window.location.href;$.post("/CsAjax.do?method=sendError",{url:o,error_msg:e},function(t){$("#sendError").hide(),"1"==t.code?layer.open({content:i18nUtils.prop("book_feedback_content_result"),btn:"Ok"}):layer.open({content:t.msg,skin:"msg",time:2})})}})}},$(document).ready(function(){BookUtils.init()});